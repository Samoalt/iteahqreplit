Auth & Role-Switching for iTea Flow
(co-branded sign-in, self-registration, forgot-password, and workspace/role switcher)

1 | Entry Point Pages
URL	What the user sees	Components
/login	Split card:
• Left: iTea Flow logo, tagline
• Right: Email + Password inputs, Log In CTA, link “Create account” & “Forgot password”	Validation, “Show password” eye, error banner
/register	• Progress bar (Step 1 of 3)
• Form fields depend on chosen Role	Role selector, dynamic form
/forgot-password	Email input + “Send reset link”	Success toast “Check your inbox”

2 | Registration Flow (self-service for Producers & Buyers)
Step	Screen	Fields & Actions	Validation & Events
1. Role & Email	/register Step 1	• Radio buttons: Producer / Buyer / Lender • Email • Password	Check email not in use → POST /auth/signup ; send verification email
2. Org Details	Step 2	• Legal name • Country • KRA PIN • Phone • Preferred currency	Duplicate org check; KYC status = Draft
3. Wallet / Bank	Step 3	• “Generate Elastic Wallet” or “Provide bank IBAN”	If Elastic wallet → call /wallet/create ; else store bank for payouts
Finish	Success page	“Verify email & upload KYC docs.” Button Go to Dashboard (Dashboard shows KYC Pending banner)	Email with verify link, KYC checklist

KTDA Board users do not self-register; they are invited by iTea Ops (see Admin workflow).

3 | Email Verification & KYC Upload
Trigger	Action
User clicks verification link	/auth/verify?token=… → account status = Email Verified
Dashboard banner “Complete KYC”	Opens modal to upload ID/CoI docs; calls /kyc/upload ; status pill on Directory row updates pending → active after compliance review

4 | Forgot Password Flow
/forgot-password – enter email → POST /auth/forgot

Email sent with 6-digit code or link (24 h TTL)

/reset-password?token=… page – new password + confirm → POST /auth/reset

Toast “Password reset successful”, auto-redirect to /login

5 | Login & Workspace Switch
User logs in → JWT issued with claims: {tenant:"itea-flow", roles:["producer","buyer"]}

After login, Workspace Picker modal shows if multiple roles:

sql
Copy
Edit
Select your workspace
─────────────────────────
▸ Producer – Factory Marigu  (last used)
▸ Buyer – Exporter K-BRK
Top-bar Role/Workspace Switcher (avatar dropdown) lets user hop without re-auth; app reloads with new role ACLs.

6 | Admin-Side “Invite User” Flow (iTea Ops)
Admin → Users tab → Invite User

Choose Workspace (Producer, Buyer, KTDA Board)

Enter Name & Email → system sends sign-up link pre-stamped with role; invitation_id stored

Invitee completes registration; invitation row flips to Accepted.

7 | Auth API End-points (stub for prototype)
http
Copy
Edit
POST /auth/signup        {email,pw,role}
POST /auth/login         {email,pw}
POST /auth/forgot        {email}
POST /auth/reset         {token,new_pw}
POST /auth/verify        {token}
POST /kyc/upload         {files[]}
POST /invites            {email,role}
GET  /workspaces         → [{id,name,role}]
8 | Status & Error Handling
Scenario	UX response
Wrong password	Red banner “Email or password incorrect.”
Email unverified	Yellow alert “Verify your email to continue.” + resend link
KYC rejected	Red alert with reason; re-upload button
Workspace access revoked	Switcher hides that option; if bookmarked, show 403 page

9 | Design Tokens
Token	Value
Primary button	Green #01624E
Secondary link	Blue #3B82F6 underline on hover
Error text	Red #F04438
Success toast	Green background, white text

In One Sentence
The AI-generated UI will deliver branded sign-in, self-service registration for producers and buyers, email/KYC verification, password resets, invitation-only KTDA workspace access, and a seamless role switcher—tying all authentication flows to Elastic OS JWTs so users can hop between Producer, Buyer, and KTDA views without logging out.